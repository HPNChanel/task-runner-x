# Task Runner X Risk Register

| #   | Risk Hotspot & Evidence                                                                                                                                                                                                                                          | Owner    | Suggested Mitigations                                                                                                         |
| --- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ----------------------------------------------------------------------------------------------------------------------------- |
| 1   | New worker instances call `xinfo_groups` on the stream without guarding for the stream’s absence, so first-run deployments will crash instead of creating the consumer group.【F:taskrunnerx/worker/worker.py†L21-L31】                                          | Platform | Wrap the bootstrap in error handling that creates the stream/group when `xinfo_groups` fails; add startup smoke test to CI.   |
| 2   | Workers acknowledge Redis messages even when task execution raises, permanently dropping failed jobs after a single attempt.【F:taskrunnerx/worker/worker.py†L61-L65】                                                                                           | Backend  | Only ACK after successful completion, or re-enqueue/track failures via a dead-letter stream with configurable retry policies. |
| 3   | The worker loop never inspects or claims pending messages, so any in-flight task at process crash remains stuck as `running` in MySQL with no auto-recovery.【F:taskrunnerx/worker/worker.py†L68-L88】                                                           | Backend  | Implement periodic XPENDING/XCLAIM recovery, plus a reconciliation job that resets stale tasks.                               |
| 4   | Task persistence commits before the Redis enqueue, so queue failures leave orphaned `queued` rows that never execute.【F:taskrunnerx/app/api/routes/**init**.py†L16-L21】【F:taskrunnerx/app/deps.py†L5-L15】                                                    | Backend  | Introduce an outbox/transactional message pattern or move enqueue inside the DB transaction with compensation logic.          |
| 5   | Central logging setup references `settings.LOG_LEVEL`, but the configuration model only exposes `log_level`, so importing the helper raises an AttributeError and breaks observability.【F:taskrunnerx/logging.py†L7-L24】【F:taskrunnerx/app/config.py†L6-L28】 | Platform | Update logging bootstrap to call `get_settings().log_level` (or fix config casing) and add regression tests.                  |
| 6   | Queue writes cap the stream at ~10k entries with approximate trimming, risking silent message loss under bursts before workers can consume.【F:taskrunnerx/app/services/queue.py†L23-L33】                                                                       | Platform | Move retention controls to Redis config or monitor depth; emit alerts when trimming occurs and scale workers accordingly.     |
| 7   | Public API endpoints lack any authentication, rate limiting, or tenancy guards, enabling untrusted actors to enqueue arbitrary work.【F:taskrunnerx/app/api/routes/**init**.py†L12-L35】                                                                         | Security | Add authn/z middleware (e.g., API tokens or OIDC) and request quotas before production exposure.                              |
| 8   | Repository relies on manual Makefile targets with no automated CI workflows, so regressions in linting, formatting, or runtime behaviour can land undetected.【F:Makefile†L1-L22】【96f660†L1-L3】                                                               | DevEx    | Add GitHub Actions (or equivalent) to run unit tests, lint, and basic integration checks on each PR.                          |
| 9   | Task timestamps are stored in timezone-aware columns but populated with naive `datetime.utcnow()` values, risking inconsistent audit data and SQLAlchemy warnings.【F:taskrunnerx/app/models.py†L16-L19】【F:taskrunnerx/app/services/tasks.py†L24-L36】         | Backend  | Use timezone-aware `datetime.now(timezone.utc)` (or database defaults) and normalise existing data.                           |
| 10  | Failure handling simply marks tasks as `failed` with the last error and provides no automatic retry or alerting path, requiring manual operator intervention for transient issues.【F:taskrunnerx/app/services/tasks.py†L29-L40】                                | Ops      | Define retry policies, add alerting on `failed` status spikes, and surface failure dashboards for operators.                  |
